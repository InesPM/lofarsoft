
##_______________________________________________________________________________
##                                                           List of source files

file (GLOB tests_IO *.cc)

if (NOT HAVE_CASACORE OR NOT DAL_LIBRARIES OR NOT HDF5_LIBRARIES)
  list (REMOVE_ITEM tests_IO ${CURRENT_SOURCE_DIR}/LOFAR_TBB.cc)
endif (NOT HAVE_CASACORE OR NOT DAL_LIBRARIES OR NOT HDF5_LIBRARIES)

##_______________________________________________________________________________
##                                                     Build/Install instructions

foreach (src ${tests_IO})

  ## extract the components of the filename
  get_filename_component (_name ${src} NAME_WE)
  get_filename_component (_ext ${src} EXT)
  ## compiler instructions
  add_executable(${_name} ${_name}${_ext})
  ## linker instructions
  target_link_libraries (${_name} cr ${cr_link_libraries})
  ## installation instructions
  install (
    TARGETS ${_name}
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
    )

endforeach (src)

##_______________________________________________________________________________
##                                                            Testing preparation

if (dataset_tbb)
  
  find_program (BASH_EXCUTABLE bash)
  get_filename_component (dataset_tbb_local ${dataset_tbb} NAME)
  
  foreach (testScript
      tLOFAR_TBB
      )
    configure_file (${CR_SOURCE_DIR}/implement/IO/test/${testScript}.sh
      ${CR_BINARY_DIR}/implement/IO/test/${testScript}.sh
      )
  endforeach (testScript)
  
endif (dataset_tbb)

##_______________________________________________________________________________
##                                                           Testing instructions

foreach (test
    tApplyInstrumentEffects
    tDataBlockSettings
    tDataIterator
    tDataReader
    tFFTServer
    tFalckeGorhamGalacticNoise
    tITSMetadata
    tImportAntenna
    tImportSimulation
    tLogfileName
    tNDABeam
    tObservationData
    tRawSubbandIn
    tSimulation2fftMatrix
    tTSmatrix2Event
    tgenTVSpec
    tsimulation2event
    ttbbctlIn
    tTIM40Header
    ttoLOPESgrid
    )
  add_test (${test} ${test})
endforeach (test)

## Tests which need additional input
    
if (dataset_lopes)
  add_test (tUpSampledDR tUpSampledDR ${dataset_lopes})
  add_test (tLopesEventIn tLopesEventIn ${dataset_lopes})
else (dataset_lopes)
  add_test (tUpSampledDR tUpSampledDR)
  add_test (tLopesEventIn tLopesEventIn)
endif (dataset_lopes)

if (dataset_tbb)
  add_test (tLOFAR_TBB ${BASH_EXCUTABLE} tLOFAR_TBB.sh)
else (dataset_tbb)
  add_test (tLOFAR_TBB tLOFAR_TBB)
endif (dataset_tbb)

## -----------------------------------------------------------------------------
## Installation

install (
  TARGETS ${tests}
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib
  )
