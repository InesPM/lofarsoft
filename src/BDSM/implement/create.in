#! /bin/bash
# start

## Process this to point to the correct location
export work='${BDSM_SOURCE_DIR}/implement/bdsm'

if [ $(pwd) != $work ] ; then

 \rm -fr *.f Makefile a data
 cp -R $work/*.f $work/Makefile $work/makeparadefine* $work/shapelets $work/includes $work/batchprocess $work/batchbdsm .
 
 sed 's/$(PGLIB)/ /g' Makefile > a; mv -f a Makefile
 sed 's/\/usr\/bin\///g' Makefile > a; mv -f a Makefile
 
# This is for sterrewacht machines
 case $HOSTNAME in
  "para"*) 
    sed 's/\/disks\/strw1\/mohan/\/paras\/para11\/niruj/' Makefile > a ; mv -f a Makefile
    ;;
 esac
 
 for i in 1 2 3
 do
  if [ $i = 2 ]; then
   cd shapelets
  fi
  if [ $i = 2 ]; then
   cd standalone
  fi

  for m in *.f
  do
   echo '-- Processing ${m} ...'
   sed '/call pg/s/^/c/g' ${m} > a; mv -f a ${m}
   sed '/pgopen(/s/^/c/g' ${m} > a; mv -f a ${m}
  done
  
  grep -A 1 -n " call pg" *.f | grep ' \/ ' > a
  sed -e 's/-/ /' -e 's/-[^^]*/  /g' a > b
  awk '{print "sed -e '\''" $2 "d'\'' " $1 " |sed '\''" $2-1"a QQQQ '\'' | sed '\''s/QQQQ//g'\'' $1 > c; mv -f c " $1}' b > d
  chmod 755 d
  source d
 done
 
else
  echo ' Cant run this script from here'
fi


