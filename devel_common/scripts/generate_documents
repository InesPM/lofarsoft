#!/bin/sh

## Variables to be adjusted to the local setup

lofardocs=/var/tmp/lus/docs
target_lofardocs=/var/www/wiki/data/media/documents/icd

## === Do not edit below this point =============================================

export PATH=$PATH:/usr/bin:/usr/local/bin:/opt/local/bin

##_______________________________________________________________________________
##                                          Generate documents from LaTeX sources

## Update working copy

echo "--[`date`] Updating working copy ..."

cd $lofardocs
svn up

## Build ICDs from LaTeX sources

cd $lofardocs/build
cmake ..

make ICD ICD ICD

## Compress Postscript files

cd $lofardocs/ICD

FILES=`ls LOFAR*ICD*.ps`

for FILE in $FILES ; { 
    echo "-- Compressing file $FILE ..."
    gzip $FILE ;
}

## Move generated documents to server directory

FILES=`ls LOFAR*ICD*.ps.gz LOFAR*ICD*.pdf`

for FILE in $FILES ; {
    ## convert filename to lower-case
    outfile=`echo $FILE | tr '[A-Z]' '[a-z]'`
    ## feedback
    echo "-- Moving file $outfile to the server directory ..."
    ## move the file
    mv $FILE $target_lofardocs/$outfile ;
}

echo "[`date`] Completed."
