#!/bin/sh

## Variables to be adjusted to the local setup

lofarsoft=
target_lofarsoft=/var/www/doxygen

lofardocs=
target_lofardocs=

## === Do not edit below this point =============================================


##_______________________________________________________________________________
##                                 Generate Doxygen documentation for source code

## Define LOFARSOFT environment variable

cd $lofarsoft
export LOFARSOFT=`pwd`

## update working copy of the code and build documentation

cd $lofarsoft/build
./bootstrap
make update
make doc

## move documentation to target directory

echo "-- Packing generated documentation ..."

cd $lofarsoft/doc/html
tar -czf $target_lofarsoft/html.tgz *

echo "-- Copy documentation to target directory ..."

cd $target_lofarsoft
tar -xzf html.tgz

##_______________________________________________________________________________
##                                          Generate documents from LaTeX sources


## Build ICDs from LaTeX sources

cd $lofardocs/build
cmake ..
make ICD
make ICD
make ICD

## Compress Postscript files

cd $lofardocs/ICD

FILES=`ls LOFAR*ICD*.ps`

for FILE in $FILES ; { 
    echo "-- Compressing file $FILE ..."
    gzip $FILE ;
}

## Move generated documents to server directory

FILES=`ls LOFAR*ICD*.ps.gz LOFAR*ICD*.pdf`

for FILE in $FILES ; {
    echo "-- Moving file $FILE to server directory ..." ;
    mv $FILE $target_lofardocs ;
}
